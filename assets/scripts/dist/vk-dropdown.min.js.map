{"version":3,"sources":["vk-dropdown.js","fetch.js"],"names":["VkDropdown","element","arguments","length","undefined","userConfig","_classCallCheck","this","elements","document","querySelectorAll","i","el","querySelector","console","error","defaultConfig","classNames","activeState","focusState","highlightedState","openState","container","input","inputContainer","inputContainerAddIcon","inputContainerClear","list","listItem","inputContainerArrow","listItemName","listItemPhotoContainer","multi","hasAttribute","photoPreview","config","noPhoto","photoPreviewContainer","noPhotoPreview","selectedItem","noServerSearch","selectedItemRemove","selectedList","wasTap","_onKeyDown","bind","_onClick","_onMouseOver","_onTouchMove","_onTouchEnd","_onFocus","_onBlur","xhr","_renderContainer","addEventListener","_init","_renderElement","_addEventListeners","removeEventListener","target","e","hasActiveDropdown","classList","contains","onEnterKey","listItems","item","_this","_selectItem","hideDropdown","onEscapeKey","onDirectionKey","upKey","keyCode","highlightedItem","newIndex","_highlightElement","_scrollListToHighlightElement","directionInt","preventDefault","keyDownActions","_defineProperty","_keyDownActions","selectedItems","setTimeout","_searchItems","foundTarget","_clearSelect","_removeItem","_findAncestorByAttr","_unhighlightAll","itemHover","touches","stopPropagation","relatedTarget","showDropdown","children","_unhighlightElement","scrollTop","currentItemTop","offsetTop","currentScrollTop","listHeight","offsetHeight","currentItemBottom","attr","parentElement","style","display","_getTemplate","appendChild","clear","_this2","globalClasses","className","createElement","arrow","clearButton","setAttribute","object","placeholder","id","name","photo","photoContainer","listItemEmpty","emptyItem","imgUrl","photoBlock","src","selectedItemName","innerHTML","removeBtn","addButton","inputContainerAdd","addButtonIcon","type","text","split","en","ru","join","ruBad","_getOtherKeyboardLayout","template","templates","_len","args","Array","_key","apply","_showSelectedListAddButton","_showSelectedClearButton","_hideSelectedClearButton","_renderListItems","presetItems","_renderSelectedItems","items","fromServer","_this3","fragment","selectedIds","map","getAttribute","currentRenderedItems","currentRenderedCount","currentRenderedIds","push","forEach","user","indexOf","option","_renderListItemsEmpty","optionEmpty","objects","_this4","createDocumentFragment","selectedId","_this5","filter","obj","selectedObjects","selectedObject","cloneNode","value","removeAttribute","_renderPhotoPreview","_this6","q","itemsFiltered","person","index","toLowerCase","answer","namePart","qRu2en","qEnBad2ru","qRuBad2en2ru","qEn2ru","_searchOnServer","$this","params","encodeURIComponent","JSON","stringify","abort","XMLHttpRequest","open","setRequestHeader","onload","data","parse","response","onerror","log","send","userId","_scrollListToTop","remove","_hideInput","focus","add","_hideSelectedListAddButton","_showInput","self","normalizeName","normalizeValue","test","TypeError","iteratorFor","iterator","next","String","support","iterable","shift","done","Headers","headers","Object","getOwnPropertyNames","append","isArray","header","oldValue","consumed","Promise","body","bodyUsed","reject","reader","resolve","result","promise","fileReaderReady","readAsArrayBuffer","blob","readAsText","FileReader","chars","view","Uint8Array","buf","fromCharCode","bufferClone","slice","buffer","byteLength","set","Body","_initBody","_bodyInit","Blob","_bodyBlob","formData","FormData","prototype","isPrototypeOf","_bodyFormData","searchParams","URLSearchParams","_bodyText","arrayBuffer","isDataView","_bodyArrayBuffer","toString","ArrayBuffer","isArrayBufferView","Error","rejected","readBlobAsArrayBuffer","then","readArrayBufferAsText","decode","json","methods","upcased","method","toUpperCase","options","credentials","url","normalizeMethod","referrer","mode","trim","form","bytes","decodeURIComponent","replace","rawHeaders","line","key","parts","bodyInit","ok","statusText","status","fetch","Symbol","viewClasses","isView","call","has","get","hasOwnProperty","keys","callback","thisArg","values","entries","Request","clone","Response","redirect","RangeError","redirectStatuses","location","request","init","parseHeaders","getAllResponseHeaders","responseURL","responseText","ontimeout","withCredentials","responseType","polyfill"],"mappings":"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","file":"vk-dropdown.min.js","sourcesContent":["class VkDropdown {\n    constructor(element = '[data-vk-dropdown]', userConfig) {\n        if (typeof element === 'string') {\n            const elements = document.querySelectorAll(element);\n            if (elements.length > 1) {\n                for (let i = 1; i < elements.length; i++) {\n                    const el = elements[i];\n                    new VkDropdown(el, userConfig);\n                }\n            }\n        }\n\n        this.element = typeof element === 'string' ? document.querySelector(element) : element;\n        if (!this.element) {\n            console.error('Passed element not found');\n            return;\n        }\n\n        const defaultConfig = {\n            classNames: {\n                activeState: 'is-active',\n                focusState: 'is-focused',\n                highlightedState: 'is-highlighted',\n                openState: 'is-open',\n                container: 'vk-dropdown',\n                input: 'vdd-input-container__input',\n                inputContainer: 'vdd-input-container',\n                inputContainerAdd: 'vdd-input-container__add',\n                inputContainerAddIcon: 'vdd-input-container__add-icon',\n                inputContainerArrow: 'vdd-input-container__arrow',\n                inputContainerClear: 'vdd-input-container__clear',\n                list: 'vdd-list',\n                listItem: 'vdd-list__item',\n                listItemEmpty: 'vdd-list__item-empty',\n                listItemName: 'vdd-list__name',\n                listItemPhotoContainer: 'vdd-list__photo',\n                photoPreview: 'vdd-photo-preview__item',\n                photoPreviewContainer: 'vdd-photo-preview__container',\n                selectedItem: 'vdd-input-container__selected-item',\n                selectedItemName: 'vdd-input-container__selected-item-name',\n                selectedItemRemove: 'vdd-input-container__selected-item-remove',\n                selectedList: 'vdd-input-container__selected'\n            },\n            multi: false,\n            noPhoto: false,\n            noPhotoPreview: false,\n            noServerSearch: false\n        };\n\n        this.config = Object.assign({}, defaultConfig, userConfig);\n        this.config.multi = this.config.multi || this.element.hasAttribute('data-multi');\n        this.config.noPhoto = this.config.noPhoto || this.element.hasAttribute('data-no-photo');\n        this.config.noPhotoPreview = this.config.noPhotoPreview || this.element.hasAttribute('data-no-photo-preview');\n        this.config.noServerSearch = this.config.noServerSearch || this.element.hasAttribute('data-no-server-search');\n\n        this.selectedItems = [];\n        this.xhr = null;\n        this.wasTap = true;\n\n        this._onKeyDown = this._onKeyDown.bind(this);\n        this._onClick = this._onClick.bind(this);\n        this._onMouseOver = this._onMouseOver.bind(this);\n        this._onTouchMove = this._onTouchMove.bind(this);\n        this._onTouchEnd = this._onTouchEnd.bind(this);\n        this._onFocus = this._onFocus.bind(this);\n        this._onBlur = this._onBlur.bind(this);\n\n        this._init();\n    }\n\n    _init() {\n        this._createTemplates();\n        this._renderElement();\n        this._renderContainer();\n        this._addEventListeners();\n    }\n\n    _addEventListeners() {\n        document.addEventListener('keydown', this._onKeyDown);\n        document.addEventListener('click', this._onClick);\n        document.addEventListener('mouseover', this._onMouseOver);\n        document.addEventListener('touchmove', this._onTouchMove);\n        document.addEventListener('touchend', this._onTouchEnd);\n\n        this.input.addEventListener('focus', this._onFocus);\n        this.input.addEventListener('blur', this._onBlur);\n    }\n\n    _removeEventListeners() {\n        document.removeEventListener('keydown', this._onKeyDown);\n        document.removeEventListener('click', this._onClick);\n        document.removeEventListener('mouseover', this._onMouseOver);\n        document.removeEventListener('touchmove', this._onTouchMove);\n        document.removeEventListener('touchend', this._onTouchEnd);\n\n\n        this.input.removeEventListener('focus', this._onFocus);\n        this.input.removeEventListener('blur', this._onBlur);\n    }\n\n    _onKeyDown(e) {\n        const target = e.target;\n        const hasActiveDropdown = this.list.classList.contains(this.config.classNames.activeState);\n\n        if (!hasActiveDropdown && !this.container.contains(target)) {\n            return;\n        }\n\n        const listItems = this.list.children;\n\n        const enterKey = 13;\n        const escapeKey = 27;\n        const upKey = 38;\n        const downKey = 40;\n\n        const onEnterKey = () => {\n            for (let i = 0; i < listItems.length; i++) {\n                const item = listItems[i];\n\n                if (item.classList.contains(this.config.classNames.highlightedState)) {\n                    this._selectItem(item);\n                    this.hideDropdown();\n                    return;\n                }\n            }\n        };\n\n        const onEscapeKey = () => {\n            if (hasActiveDropdown) {\n                this.hideDropdown();\n            }\n        };\n\n        const onDirectionKey = () => {\n            const directionInt = (e.keyCode === downKey ? 1 : -1);\n\n            let highlightedItem;\n            for (let i = 0; i < listItems.length; i++) {\n                const item = listItems[i];\n\n                if (item.classList.contains(this.config.classNames.highlightedState)) {\n                    this._unhighlightElement(item);\n\n                    let newIndex = i + directionInt;\n\n                    // if highlighted last item and key down, doing nothing\n                    if (newIndex >= listItems.length) {\n                        newIndex = i;\n                    }\n\n                    highlightedItem = listItems[newIndex];\n                }\n            }\n\n            if (!highlightedItem) {\n                highlightedItem = listItems[0];\n            }\n\n            this._highlightElement(highlightedItem);\n            this._scrollListToHighlightElement(highlightedItem, directionInt);\n\n            e.preventDefault();\n        };\n\n        const keyDownActions = {\n            [enterKey]: onEnterKey,\n            [escapeKey]: onEscapeKey,\n            [upKey]: onDirectionKey,\n            [downKey]: onDirectionKey,\n        };\n\n        if (keyDownActions[e.keyCode]) {\n            keyDownActions[e.keyCode]();\n        } else {\n            // no search if input non-multi and disabled (because already selected)\n            if (!this.config.multi && this.selectedItems.length) {\n                return;\n            }\n\n            // input value does not have time to fill without timeout\n            setTimeout(() => {\n                this._searchItems(this.input.value);\n            }, 0);\n        }\n    }\n\n    _onClick(e) {\n        const target = e.target;\n        const hasActiveDropdown = this.list.classList.contains(this.config.classNames.activeState);\n\n        if (this.container.contains(target)) {\n            let foundTarget;\n\n            if (target.hasAttribute('data-clear')) {\n                this._clearSelect();\n                return;\n            }\n\n            if (target.hasAttribute('data-remove')) {\n                this._removeItem(target);\n                return;\n            }\n\n            if (foundTarget = this._findAncestorByAttr(target, 'data-item')) {\n                this._selectItem(foundTarget);\n                this.hideDropdown();\n            }\n\n            if (!hasActiveDropdown) {\n                this.showDropdown();\n            }\n        } else {\n            if (hasActiveDropdown) {\n                this.hideDropdown();\n            }\n        }\n    }\n\n    _onMouseOver(e) {\n        const target = e.target;\n\n        if (target === this.list || this.list.contains(target)) {\n            this._unhighlightAll();\n\n            let itemHover;\n            if (itemHover = this._findAncestorByAttr(target, 'data-item')) {\n                this._highlightElement(itemHover);\n            }\n        }\n    }\n\n    _onTouchMove() {\n        if (this.wasTap === true) {\n            this.wasTap = false;\n        }\n    }\n\n    _onTouchEnd(e) {\n        const target = e.target || e.touches[0].target;\n        const hasActiveDropdown = this.list.classList.contains(this.config.classNames.activeState);\n\n        if (this.wasTap === true && this.container.contains(target)) {\n            if (!hasActiveDropdown) {\n                this.showDropdown();\n            }\n\n            e.stopPropagation();\n        } else {\n            if (hasActiveDropdown) {\n                this.hideDropdown();\n            }\n        }\n\n        this.wasTap = true;\n    }\n\n    _onFocus(e) {\n        const target = e.target;\n        const hasActiveDropdown = this.list.classList.contains(this.config.classNames.activeState);\n\n        if (this.container.contains(target)) {\n            if (!hasActiveDropdown) {\n                this.showDropdown();\n            }\n        }\n    }\n\n    _onBlur(e) {\n        const target = e.target;\n        const relatedTarget = e.relatedTarget;\n        const hasActiveDropdown = this.list.classList.contains(this.config.classNames.activeState);\n\n        if (relatedTarget && this.container.contains(target) && !this.container.contains(relatedTarget)) {\n            if (hasActiveDropdown) {\n                this.hideDropdown();\n            }\n        }\n    }\n\n    _highlightElement(element) {\n        element.classList.add(this.config.classNames.highlightedState);\n    }\n\n    _unhighlightElement(element) {\n        element.classList.remove(this.config.classNames.highlightedState);\n    }\n\n    _unhighlightAll() {\n        const listItems = this.list.children;\n\n        for (let i = 0; i < listItems.length; i++) {\n            const item = listItems[i];\n\n            if (item.classList.contains(this.config.classNames.highlightedState)) {\n                this._unhighlightElement(item);\n            }\n        }\n    }\n\n    _scrollListToTop() {\n        this.list.scrollTop = 0;\n    }\n\n    _scrollListToHighlightElement(element, directionInt) {\n        const currentItemBottom = element.offsetTop + element.offsetHeight;\n        const currentItemTop = element.offsetTop;\n        const currentScrollTop = this.list.scrollTop;\n        const listHeight = this.list.offsetHeight;\n\n        // move scrollbar if highlighted not in view\n        if (directionInt > 0 && currentItemBottom > listHeight) {\n            this.list.scrollTop = currentItemBottom - listHeight;\n        } else if (directionInt < 0 && (listHeight + currentItemTop < listHeight + currentScrollTop)) {\n            this.list.scrollTop = currentItemTop;\n        }\n    }\n\n    _findAncestorByAttr(el, attr) {\n        let target = el;\n\n        while (target) {\n            if (target.hasAttribute(attr)) {\n                return target;\n            }\n\n            target = target.parentElement;\n        }\n\n        return null;\n    };\n\n    _clearSelect() {\n        this.selectedItems = [];\n        this._renderContainer();\n\n        const clear = this.inputContainer.querySelectorAll('[data-clear]')[0];\n        clear.style.display = 'none';\n\n        if (this.list.classList.contains(this.config.classNames.activeState)) {\n            this.input.focus();\n        }\n    }\n\n    _renderElement() {\n        const container = this._getTemplate('container');\n        const input = this._getTemplate('input');\n        const inputContainer = this._getTemplate('inputContainer');\n        const list = this._getTemplate('list');\n\n        this.container = container;\n        this.input = input;\n        this.inputContainer = inputContainer;\n        this.list = list;\n\n        if (this.config.multi) {\n            const selectedList = this._getTemplate('selectedList');\n            this.selectedList = selectedList;\n            inputContainer.appendChild(selectedList);\n        }\n\n        inputContainer.appendChild(input);\n        container.appendChild(inputContainer);\n        container.appendChild(list);\n\n        if (!this.config.noPhotoPreview) {\n            const photoPreviewContainer = this._getTemplate('photoPreviewContainer');\n            this.photoPreviewContainer = photoPreviewContainer;\n            container.appendChild(photoPreviewContainer);\n        }\n\n        this.element.appendChild(container);\n    }\n\n    _createTemplates() {\n        const globalClasses = this.config.classNames;\n        this.config.templates = {\n            container: () => {\n                const container = document.createElement('div');\n                container.className = globalClasses.container;\n\n                return container;\n            },\n            input: () => {\n                const input = document.createElement('input');\n                input.className = globalClasses.input;\n                input.type = 'text';\n                input.placeholder = 'Name...';\n\n                return input;\n            },\n            inputContainer: () => {\n                const container = document.createElement('div');\n                container.className = globalClasses.inputContainer;\n\n                const arrow = document.createElement('div');\n                arrow.className = globalClasses.inputContainerArrow;\n                container.appendChild(arrow);\n\n                if (this.config.multi) {\n\n                } else {\n                    const clearButton = document.createElement('div');\n                    clearButton.className = globalClasses.inputContainerClear;\n                    clearButton.style.display = 'none';\n                    clearButton.setAttribute('data-clear', '');\n                    container.appendChild(clearButton);\n                }\n\n                return container;\n            },\n            list: () => {\n                const list = document.createElement('div');\n                list.className = globalClasses.list;\n\n                return list;\n            },\n            listItem: (object) => {\n                const item = document.createElement('div');\n                item.className = globalClasses.listItem;\n                item.setAttribute('data-item', '');\n                item.setAttribute('data-id', object.id);\n\n                const name = document.createElement('div');\n                name.className = globalClasses.listItemName;\n                name.innerHTML = object.name;\n\n                if (!this.config.noPhoto) {\n                    const photo = document.createElement('img');\n                    photo.src = object.photo;\n\n                    const photoContainer = document.createElement('div');\n                    photoContainer.className = globalClasses.listItemPhotoContainer;\n\n                    photoContainer.appendChild(photo);\n                    item.appendChild(photoContainer);\n                }\n\n                item.appendChild(name);\n\n                return item;\n            },\n            listItemEmpty: () => {\n                const emptyItem = document.createElement('div');\n                emptyItem.className = globalClasses.listItemEmpty;\n                emptyItem.innerHTML = 'The user is not found';\n\n                return emptyItem;\n            },\n            photoPreview: (imgUrl) => {\n                const photoBlock = document.createElement('div');\n                photoBlock.className = globalClasses.photoPreview;\n\n                const photo = document.createElement('img');\n                photo.src = imgUrl;\n\n                photoBlock.appendChild(photo);\n\n                return photoBlock\n            },\n            photoPreviewContainer: () => {\n                const container = document.createElement('div');\n                container.className = globalClasses.photoPreviewContainer;\n\n                return container;\n            },\n            selectedItem: (object) => {\n                const item = document.createElement('div');\n                item.className = globalClasses.selectedItem;\n                item.setAttribute('data-id', object.id);\n\n                const name = document.createElement('div');\n                name.className = globalClasses.selectedItemName;\n                name.innerHTML = object.name;\n\n                const removeBtn = document.createElement('div');\n                removeBtn.className = globalClasses.selectedItemRemove;\n                removeBtn.setAttribute('data-remove', '');\n\n                item.appendChild(name);\n                item.appendChild(removeBtn);\n\n                return item;\n            },\n            selectedList: () => {\n                const list = document.createElement('div');\n                list.className = globalClasses.selectedList;\n\n                const addButton = document.createElement('div');\n                addButton.className = globalClasses.inputContainerAdd;\n                addButton.innerHTML = 'Add';\n                addButton.setAttribute('data-add', '');\n\n                const addButtonIcon = document.createElement('div');\n                addButtonIcon.className = globalClasses.inputContainerAddIcon;\n\n                addButton.appendChild(addButtonIcon);\n                list.appendChild(addButton);\n\n                return list;\n            }\n        };\n    }\n\n    _getOtherKeyboardLayout(text, type) {\n        if (!type) {\n            return text;\n        }\n\n        const ru = \"щ   ш  ч  ц  ю  я  ё  ж  ъ  ы  э  а б в г д е з и й к л м н о п р с т у ф х ь\".split(/ +/g);\n        const en = \"shh sh ch cz yu ya yo zh `` y' e` a b v g d e z i j k l m n o p r s t u f x `\".split(/ +/g);\n        const ruBad = \"o i x w . z \\\\ ; ] s ' f , d u l t p b q r k v y j g h c n e a [ m\".split(/ +/g);\n\n        switch (type) {\n            case 'ru2en':\n                for (let i = 0; i < ru.length; i++) {\n                    text = text.split(ru[i]).join(en[i]);\n                }\n\n                return text;\n\n            case 'en2ru':\n                for (let i = 0; i < ru.length; i++) {\n                    text = text.split(en[i]).join(ru[i]);\n                }\n\n                return text;\n\n            case 'enBad2ru':\n                for (let i = 0; i < ru.length; i++) {\n                    text = text.split(ruBad[i]).join(ru[i]);\n                }\n\n                return text;\n\n            case 'ruBad2en2ru':\n                for (let i = 0; i < ru.length; i++) {\n                    text = text.split(ru[i]).join(ruBad[i]);\n                }\n\n                return this._getOtherKeyboardLayout(text, 'en2ru');\n        }\n\n        return text;\n    }\n\n    _getTemplate(template, ...args) {\n        if (!template) {\n            return null;\n        }\n\n        const templates = this.config.templates;\n        return templates[template](...args);\n    }\n\n    _renderContainer() {\n        if (this.config.multi) {\n            if (this.selectedItems.length) {\n                this._showSelectedListAddButton();\n            }\n        } else {\n            if (this.selectedItems.length) {\n                this._showSelectedClearButton();\n            } else {\n                this._hideSelectedClearButton();\n            }\n        }\n\n        this._renderListItems(this.config.presetItems);\n        this._renderSelectedItems();\n    }\n\n    _renderListItems(items, fromServer) {\n        const fragment = document.createDocumentFragment();\n        const selectedIds = this.selectedItems.map((item) => +item.getAttribute('data-id'));\n\n        const currentRenderedItems = this.list.querySelectorAll('[data-item]');\n        let currentRenderedCount = currentRenderedItems.length;\n        let currentRenderedIds = [];\n\n        if (fromServer) {\n            for (let i = 0; i < currentRenderedCount; i++) {\n                const item = currentRenderedItems[i];\n                currentRenderedIds.push(+item.getAttribute('data-id'));\n            }\n        }\n\n        items.forEach((user) => {\n            // if local search and not in selected or\n            // server search and not in rendered\n            if ((!fromServer && !~selectedIds.indexOf(user.id)) || (fromServer && !~currentRenderedIds.indexOf(user.id))) {\n                const option = this._getTemplate('listItem', user);\n\n                fragment.appendChild(option);\n            }\n        });\n\n        if (!fromServer || (fromServer && !currentRenderedCount)) {\n            this.list.innerHTML = '';\n        }\n        this.list.appendChild(fragment);\n\n        currentRenderedCount = this.list.querySelectorAll('[data-item]').length;\n        if (!currentRenderedCount) {\n            this._renderListItemsEmpty();\n        }\n    }\n\n    _renderListItemsEmpty() {\n        const optionEmpty = this._getTemplate('listItemEmpty');\n        this.list.appendChild(optionEmpty);\n    }\n\n    _renderPhotoPreview(objects) {\n        const fragment = document.createDocumentFragment();\n\n        objects.forEach((object) => {\n            const photo = this._getTemplate('photoPreview', object.photo);\n\n            fragment.appendChild(photo);\n        });\n\n        this.photoPreviewContainer.innerHTML = '';\n        this.photoPreviewContainer.appendChild(fragment);\n    }\n\n    _renderSelectedItems() {\n        const selectedIds = this.selectedItems.map((item) => +item.getAttribute('data-id'));\n        let selectedObjects = [];\n\n        for (let i = 0; i < selectedIds.length; i++) {\n            const selectedId = selectedIds[i];\n            const selectedObject = this.config.presetItems.filter((obj) => {\n                return obj.id === selectedId;\n            })[0];\n\n            selectedObjects.push(selectedObject);\n        }\n\n        if (this.config.multi) {\n            const fragment = document.createDocumentFragment();\n            const addButton = this.selectedList.querySelectorAll('[data-add]')[0].cloneNode(true);\n            addButton.style.display = this.selectedItems.length ? 'inline-block' : 'none';\n\n            selectedObjects.forEach((object) => {\n                const option = this._getTemplate('selectedItem', object);\n\n                fragment.appendChild(option);\n            });\n\n            this.selectedList.innerHTML = '';\n            this.selectedList.appendChild(fragment);\n            this.selectedList.appendChild(addButton);\n        } else {\n            if (this.selectedItems.length > 0) {\n                const selectedId = +this.selectedItems[0].getAttribute('data-id');\n                const selectedObject = this.config.presetItems.filter((obj) => {\n                    return obj.id === selectedId;\n                })[0];\n\n                this.input.value = selectedObject.name;\n                this.input.setAttribute('readonly', 'readonly');\n            } else {\n                this.input.value = '';\n                this.input.removeAttribute('readonly');\n            }\n        }\n\n        if (!this.config.noPhotoPreview) {\n            this._renderPhotoPreview(selectedObjects);\n        }\n    }\n\n    _searchItems(value) {\n        if (!value) {\n            this._renderListItems(this.config.presetItems);\n        }\n\n        const items = this.config.presetItems;\n        const q = value.toLowerCase();\n\n        let itemsFiltered = items.filter((person, index) => {\n            const name = person.name.toLowerCase().split(' ');\n            let answer = false;\n\n            // split name for search only from begin of first name/last name\n            for (let i = 0; i < name.length; i++) {\n                const namePart = name[i];\n\n                const qRu2en = this._getOtherKeyboardLayout(q, 'ru2en');\n                const qEn2ru = this._getOtherKeyboardLayout(q, 'en2ru');\n                const qEnBad2ru = this._getOtherKeyboardLayout(q, 'enBad2ru');\n                const qRuBad2en2ru = this._getOtherKeyboardLayout(q, 'ruBad2en2ru');\n\n                answer = !namePart.indexOf(q) ||\n                         !namePart.indexOf(qRu2en) ||\n                         !namePart.indexOf(qEn2ru) ||\n                         !namePart.indexOf(qEnBad2ru) ||\n                         !namePart.indexOf(qRuBad2en2ru);\n\n                if (answer) {\n                    return answer;\n                }\n            }\n\n            return answer;\n        });\n\n        this._renderListItems(itemsFiltered);\n\n        if (!this.config.noServerSearch) {\n            this._searchOnServer(q);\n        }\n    }\n\n    _searchOnServer(q) {\n        const $this = this;\n        const params = `items=${encodeURIComponent(JSON.stringify(this.config.presetItems))}&q=${q}`;\n\n        if (this.xhr && this.xhr.readyState !== 4) {\n            this.xhr.abort();\n        }\n\n        this.xhr = new XMLHttpRequest();\n        this.xhr.open('POST', 'api.php', true);\n        this.xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n        this.xhr.onload = function() {\n            if (this.status >= 200 && this.status < 400) {\n                const data = JSON.parse(this.response);\n\n                $this._renderListItems(data, true);\n            }\n        };\n        this.xhr.onerror = function(error) {\n            console.log(error)\n        };\n        this.xhr.send(params);\n\n        // todo can opera 12.16 support Promise?\n        // const data = new FormData();\n        // data.append('items', JSON.stringify(this.config.presetItems));\n        // data.append('q', q);\n        //\n        // fetch('api.php', {\n        //     method: 'POST',\n        //     body: data\n        // }).then((response) => response.json()).then((result) => {\n        //     console.log(result);\n        // }).catch((error) => console.log(error));\n    }\n\n    _selectItem(element) {\n        if (!element) {\n            return;\n        }\n\n        this.input.value = '';\n\n        if (!this.config.multi) {\n            this.selectedItems = [];\n        }\n\n        this.selectedItems.push(element);\n\n\n        this._renderContainer();\n    }\n\n    _removeItem(element) {\n        if (!element || !this.config.multi) {\n            return;\n        }\n\n        const userId = +element.parentElement.getAttribute('data-id');\n        this.selectedItems = this.selectedItems.filter(function(obj) {\n            return +obj.getAttribute('data-id') !== userId;\n        });\n\n        this.hideDropdown();\n        this._renderContainer();\n    }\n\n    hideDropdown() {\n        this.input.blur();\n        this._scrollListToTop();\n        this._unhighlightAll();\n\n        this.container.classList.remove(this.config.classNames.openState);\n        this.list.classList.remove(this.config.classNames.activeState);\n\n        if (this.config.multi) {\n            if (!this.selectedItems.length) {\n                this._showInput();\n            }\n\n            if (this.selectedItems.length && !this.input.value) {\n                this._showSelectedListAddButton();\n                this._hideInput();\n            }\n        }\n    }\n\n    showDropdown() {\n        this.input.focus();\n        this.container.classList.add(this.config.classNames.openState);\n        this.list.classList.add(this.config.classNames.activeState);\n\n        if (this.config.multi) {\n            this._hideSelectedListAddButton();\n            this._showInput();\n            this.input.focus();\n        }\n    }\n\n    _hideSelectedClearButton() {\n        const clearButton = this.inputContainer.querySelectorAll('[data-clear]')[0];\n        clearButton.style.display = 'none';\n    }\n\n    _showSelectedClearButton() {\n        const clearButton = this.inputContainer.querySelectorAll('[data-clear]')[0];\n        clearButton.style.display = 'block';\n    }\n\n    _hideSelectedListAddButton() {\n        const addButton = this.selectedList.querySelectorAll('[data-add]')[0].cloneNode(true);\n        addButton.style.display = 'none';\n    }\n\n    _showSelectedListAddButton() {\n        const addButton = this.selectedList.querySelectorAll('[data-add]')[0].cloneNode(true);\n        addButton.style.display = 'inline-block';\n    }\n\n    _hideInput() {\n        this.input.style.display = 'none';\n    }\n\n    _showInput() {\n        this.input.style.display = 'inline';\n    }\n}","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n\n    var isDataView = function(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj)\n    }\n\n    var isArrayBufferView = ArrayBuffer.isView || function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1])\n      }, this)\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue+','+value : value\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n\n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = String(input)\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, { body: this._bodyInit })\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    rawHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = 'status' in options ? options.status : 200\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : 'OK'\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n      var xhr = new XMLHttpRequest()\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n"]}